/* Built with Hydra */(function(){function g(){return function(){}}var h,j=this;
function aa(a){var b=typeof a;if(b=="object")if(a){if(a instanceof Array||!(a instanceof Object)&&Object.prototype.toString.call(a)=="[object Array]"||typeof a.length=="number"&&typeof a.splice!="undefined"&&typeof a.propertyIsEnumerable!="undefined"&&!a.propertyIsEnumerable("splice"))return"array";if(!(a instanceof Object)&&(Object.prototype.toString.call(a)=="[object Function]"||typeof a.call!="undefined"&&typeof a.propertyIsEnumerable!="undefined"&&!a.propertyIsEnumerable("call")))return"function"}else return"null";
else if(b=="function"&&typeof a.call=="undefined")return"object";return b}Math.floor(Math.random()*2147483648).toString(36);function k(a,b){var c=b||j;if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(c,e)}}else return function(){return a.apply(c,arguments)}}function l(a,b){function c(){}c.prototype=b.prototype;a.T=b.prototype;a.prototype=new c};var m,ba,ca,n;var o=Math.random;function p(a,b,c,d){return b+(c-b)*(a/d)}function fa(a,b,c,d){a/=d;return(c-b)*a*a+b};function ga(a,b){var c=a.indexOf(b);if(c>=0){a.splice(c,1);return true}else return false}function q(a,b){a[a.length]=b};function ha(a,b,c,d){var e=a.getPropertyValue("-webkit-transition-property");if(e){var f=e.split(", ").indexOf(b);if(f<0){a.setProperty("-webkit-transition-property",e+", "+b,"");a.setProperty("-webkit-transition-duration",a.getPropertyValue("-webkit-transition-duration")+", "+c,"");a.setProperty("-webkit-transition-timing-function",a.getPropertyValue("-webkit-transition-timing-function")+", "+d,"")}else{b=a.getPropertyValue("-webkit-transition-duration").split(", ");b[f]=c;a.setProperty("-webkit-transition-duration",
b.join(", "),"");c=a.getPropertyValue("-webkit-transition-timing-function").split(", ");c[f]=d;a.setProperty("-webkit-transition-timing-function",c.join(", "),"")}}else{a.setProperty("-webkit-transition-property",b,"");a.setProperty("-webkit-transition-duration",c,"");a.setProperty("-webkit-transition-timing-function",d,"")}}
function ia(a,b){var c=a.getPropertyValue("-webkit-transition-property");if(c){var d=c.split(", ");c=d.indexOf(b);if(c>=0)if(d.length>1){d.splice(c,1);a.setProperty("-webkit-transition-property",d.join(", "),"");d=a.getPropertyValue("-webkit-transition-duration").split(", ");d.splice(c,1);a.setProperty("-webkit-transition-duration",d.join(", "),"");d=a.getPropertyValue("-webkit-transition-timing-function").split(", ");d.splice(c,1);a.setProperty("-webkit-transition-timing-function",d.join(", "),"")}else{a.setProperty("-webkit-transition-property",
"","");a.setProperty("-webkit-transition-duration","","");a.setProperty("-webkit-transition-timing-function","","")}}}function r(a){var b=document.createElement("div");b.className=a;return b}function s(a){var b=document.createElement("div");b.innerHTML=a;if(b.childElementCount==1)b=b.firstElementChild;return b};function t(a){ja.call(this);this.element=a||document.createElement("div");this.y=this.x=0;this.A=this.F=1;this.rotation=0}l(t,ja);t.prototype.detach=function(){if(this.parent){if(ga(this.parent.p,this)){this.parent=null;this.detach()}}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)};t.prototype.j=function(){t.T.j.call(this);this.detach();this.element=null};function ka(a,b){a.x=b;v(a)}function w(a,b){a.y=b;v(a)}function x(a,b,c){a.x=b;a.y=c;v(a)}
function la(a,b){a.F=b;a.A=b;v(a)}function v(a){a.element.style.webkitTransform="translate3d("+a.x+"px,"+a.y+"px,0)rotate("+a.rotation+"deg)scale("+a.F+","+a.A+")"}function y(a){t.call(this,a);this.p=[]}l(y,t);y.prototype.v=function(a){y.T.v.call(this,a);for(var b=0;b<this.p.length;++b)z(a,this.p[b],null)};y.prototype.j=function(){y.T.j.call(this);for(var a=0;a<this.p.length;++a){var b=this.p[a];b.parent=null;b.j()}};
function A(a,b){if(a.g!=null&&b.g==null)z(a.g,b,a);else{if(b.parent!=null)if(ga(b.parent.p,b)){b.parent=null;b.detach()}q(a.p,b);b.parent=a;a.element.appendChild(b.element)}}function B(a,b,c,d){this.l=a;this.duration=1E3*b;this.$=c;this.S=d;this.t=ma;this.m=0}var ma=0;B.prototype.s=g();function C(a,b,c){return a.J(a.m,b,c,a.duration)}B.prototype.handleEvent=function(a){if(a.propertyName==this.l){this.t=2;a.target.removeEventListener("webkitTransitionEnd",this,false)}};
B.prototype.update=function(a,b){b=this.S||b;switch(this.t){case 1:this.m+=a;if(this.m>this.duration)this.m=this.duration;this.s(b);return false;case ma:var c=window.getComputedStyle(b.element,null).getPropertyValue(this.l);this.z(b);if(c!=b.element.style.getPropertyValue(this.l)){this.t=1;ha(b.element.style,this.l,this.duration+"ms",this.$);b.element.addEventListener("webkitTransitionEnd",this,false);this.m=0;this.s(b);return false}else return true;case 2:this.t=ma;ia(b.element.style,this.l);this.m=
this.duration;this.s(b);return true}};B.prototype.stop=function(a){if(this.t==1){a=this.S||a;var b=window.getComputedStyle(a.element,null).getPropertyValue(this.l);ia(a.element.style,this.l);a.element.removeEventListener("webkitTransitionEnd",this,false);a.element.style.setProperty(this.l,b,"")}};
B.prototype.start=function(a){if(this.t==1){a=this.S||a;var b=window.getComputedStyle(a.element,null).getPropertyValue(this.l);this.z(a);if(b!=a.element.style.getPropertyValue(this.l)){ha(a.element.style,this.l,this.duration-this.m+"ms",this.$);a.element.addEventListener("webkitTransitionEnd",this,false)}else this.t=2}};function na(a,b,c,d,e){B.call(this,a,c,d,e);this.value=b}l(na,B);na.prototype.z=function(a){a.element.style.setProperty(this.l,this.value,"")};
function D(a,b,c,d,e,f){B.call(this,"-webkit-transform",c,d,f);this.x=a;this.y=b;this.J=e}l(D,B);D.prototype.z=function(a){this.B=a.x;this.C=a.y;a.x=this.x;a.y=this.y;v(a)};D.prototype.s=function(a){a.x=C(this,this.B,this.x);a.y=C(this,this.C,this.y)};function E(a,b,c,d,e,f){B.call(this,"-webkit-transform",c,d,f);this.la=a;this.ma=b;this.J=e}l(E,B);E.prototype.z=function(a){this.B=a.x;this.C=a.y;if(this.V==null){this.V=this.la+a.x;this.ga=this.ma+a.y}a.x=this.V;a.y=this.ga;v(a)};
E.prototype.s=function(a){a.x=C(this,this.B,this.V);a.y=C(this,this.C,this.ga)};function F(a,b,c,d,e,f){B.call(this,"-webkit-transform",c,d,f);this.x=a;this.y=b;this.J=e}l(F,B);F.prototype.z=function(a){this.B=a.F;this.C=a.A;a.F=this.x;a.A=this.y;v(a)};F.prototype.s=function(a){a.F=C(this,this.B,this.x);a.A=C(this,this.C,this.y)};function oa(a,b,c,d,e){B.call(this,"-webkit-transform",b,c,e);this.rotation=a;this.J=d}l(oa,B);
oa.prototype.z=function(a){this.pa=a.rotation;a.rotation+=this.rotation;v(a);this.Ha=a.rotation};oa.prototype.s=function(a){a.rotation=C(this,this.pa,this.Ha)};function G(a,b,c,d){return new na(a,b,c,"linear",d)}function H(a,b,c,d){return new D(a,b,c,"linear",p,d)}function pa(a,b,c,d){return new D(a,b,c,"ease-out",p,d)};function qa(){this.D={}}qa.prototype.addEventListener=function(a,b){var c=this.D[a];if(c==null)this.D[a]=[b];else q(c,b)};qa.prototype.removeEventListener=function(a,b){var c=this.D[a];c!=null&&ga(c,b)};qa.prototype.dispatchEvent=function(a){var b=this.D[a];if(b!=null){var c=Array.prototype.slice.apply(arguments);c.shift();for(var d=0;d<b.length;++d)b[d].apply(undefined,c)}};function ra(){this.L=[]}ra.prototype.e=function(a,b,c){q(this.L,new sa(a,b,c));a.addEventListener(b,c,false)};
ra.prototype.G=function(){for(var a=0;a<this.L.length;++a){var b=this.L[a];b.ka.removeEventListener(b.na,b.ra,false)}this.L=[]};function sa(a,b,c){this.ka=a;this.na=b;this.ra=c};var I=[],J=document.getElementById("hydra-stage");function ta(a){if(a!=m){m&&m.r();for(var b=I.length-1;b>=0;--b){var c=I[b];if(a!=c){--I.length;c.Y()}else{m=c;a.q();return}}I=[a];m=a;a.load();a.q()}}function K(){if(I.length>1){var a=I.pop();a.r();a.Y();m=I[I.length-1];m.q()}}function O(a){m&&m.r();q(I,a);m=a;a.load();a.q()}function ua(){var a=Date.now();m.update(a-ba);ba=a}
function va(){if(J!=null){J.parentNode.removeChild(J);for(J=null;I.length>0;){var a=I.pop();a.r();a.Y()}m=null;clearInterval(ca)}}function ja(){this.a=[];this.g=null}h=ja.prototype;h.e=function(a,b,c){if(!this.K)this.K=new ra;this.K.e(a,b,c)};h.G=function(){this.K&&this.K.G()};h.c=function(a){this.a.length==0&&this.g!=null&&q(this.g.u,this);q(this.a,a);a.start(this)};h.O=function(){for(var a=0;a<this.a.length;++a){var b=this.a[a];if(b){b.stop(this);this.a[a]=null}}};
h.v=function(a){this.g=a;this.a.length>0&&q(this.g.u,this)};h.update=function(a){for(var b=0;b<this.a.length;++b){var c=this.a[b];if(!c||c.update(a,this))this.a.splice(b--,1)}return b==0};h.j=function(){this.O();this.G();if(this.g!=null){ga(this.g.entities,this);this.g=null}};h.q=function(){for(var a=0;a<this.a.length;++a){var b=this.a[a];b&&b.start(this)}};h.r=function(){for(var a=0;a<this.a.length;++a){var b=this.a[a];b&&b.stop(this)}};
function P(a){this.entities=[];this.u=[];this.name=a;this.d=new y(r("scene scene-"+a));z(this,this.d,J)}h=P.prototype;h.update=function(a){for(var b=0;b<this.u.length;++b){var c=this.u[b];if(!c||c.update(a))this.u.splice(b--,1)}};function z(a,b,c){if(!b.g){q(a.entities,b);b.v(a);if(b instanceof t)if(c instanceof HTMLElement)c.appendChild(b.element);else if(c!==null){c=c||a.d;A(c,b)}}}h.load=g();
h.Y=function(){for(var a=0;a<this.entities.length;++a){var b=this.entities[a];if(b.g!=null){b.g=null;b.j()}}this.entities=[];this.u=[]};h.q=function(){for(var a=0;a<this.entities.length;++a)this.entities[a].q()};h.r=function(){for(var a=0;a<this.entities.length;++a)this.entities[a].r()};h.e=function(a,b,c){this.d.e(a,b,c)};h.G=function(){this.d.G()};h.c=function(a){this.d.c(a)};h.O=function(){this.d.O()};function Q(a){this.oa=a}Q.prototype.start=g();Q.prototype.stop=g();Q.prototype.update=function(a,b){this.oa(a,b);return true};function R(a){this.Z=1E3*a;this.m=0}R.prototype.start=g();R.prototype.stop=g();R.prototype.update=function(a){this.m+=a;if(this.m>=this.Z){this.m=0;return true}else return false};function S(a){this.a=a;this.H=[]}S.prototype.stop=function(a){for(var b=0;b<this.a.length;++b){var c=this.a[b];c&&c.stop(a)}};
S.prototype.start=function(a){for(var b=0;b<this.a.length;++b){var c=this.a[b];c&&c.start(a)}};S.prototype.update=function(a,b){for(var c=0;c<this.a.length;++c){var d=this.a[c];if(d&&d.update(a,b)){this.a[c]=null;q(this.H,d)}}if(this.H.length==this.a.length){this.a=this.H;this.H=[];return true}else return false};function T(a){this.U=a}T.prototype.stop=function(a){this.U.stop(a)};T.prototype.start=function(a){this.U.start(a)};T.prototype.update=function(a,b){this.U.update(a,b);return false};
function wa(){}wa.prototype.start=g();wa.prototype.stop=g();wa.prototype.update=function(a,b){b.j();return true};function U(a){this.a=a;this.o=0}U.prototype.stop=function(a){this.o<this.a.length&&this.a[this.o].stop(a)};U.prototype.start=function(a){this.o<this.a.length&&this.a[this.o].start(a)};U.prototype.update=function(a,b){if(this.a[this.o].update(a,b))if(++this.o<this.a.length){this.a[this.o].start(b);return false}else{this.o=0;return true}else return false};function V(a){t.call(this,a);this.Ja=false;a=this.element;if(a.className)(" "+a.className+" ").indexOf(" button ")>=0||(a.className+=" button");else a.className="button";this.e(this.element,"touchstart",this);this.e(this.element,"touchend",this);this.e(this.element,"touchcancel",this)}l(V,t);V.prototype.n=g();
V.prototype.handleEvent=function(a){if(m==this.g)switch(a.type){case "touchstart":var b=this.element;if(b.className)(" "+b.className+" ").indexOf(" button-down ")>=0||(b.className+=" button-down");else b.className="button-down";break;case "touchend":case "touchcancel":if(!a.targetTouches.length){b=this.element;var c=b.className.split(" "),d=c.indexOf("button-down");if(d>=0){c.splice(d,1);b.className=c.join(" ")}this.n()}}a.stopPropagation()};function xa(a){return eval("("+a+")")}function ya(a){var b=[];za(new Aa,a,b);return b.join("")}function Aa(){}
function za(a,b,c){switch(typeof b){case "string":Ba(a,b,c);break;case "number":c.push(isFinite(b)&&!isNaN(b)?b:"null");break;case "boolean":c.push(b);break;case "undefined":c.push("null");break;case "object":if(b==null){c.push("null");break}if(aa(b)=="array"){var d=b.length;c.push("[");for(var e="",f=0;f<d;f++){c.push(e);za(a,b[f],c);e=","}c.push("]");break}c.push("{");d="";for(e in b)if(b.hasOwnProperty(e)){f=b[e];if(typeof f!="function"){c.push(d);Ba(a,e,c);c.push(":");za(a,f,c);d=","}}c.push("}");
break;case "function":break;default:throw Error("Unknown type: "+typeof b);}}var Ca={'"':'\\"',"\\":"\\\\","/":"\\/","\u0008":"\\b","\u000c":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\u000b":"\\u000b"},Da=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function Ba(a,b,c){c.push('"',b.replace(Da,function(d){if(d in Ca)return Ca[d];var e=d.charCodeAt(0),f="\\u";if(e<16)f+="000";else if(e<256)f+="00";else if(e<4096)f+="0";return Ca[d]=f+e.toString(16)}),'"')};"JSON"in window||(JSON={parse:xa,stringify:ya});"localStorage"in window||(localStorage={});var Ea=null;function Fa(a){Ea.game_start(a)};var Ga=true;try{document.createEvent("TouchEvent")}catch(Ha){Ga=false}var Ia=null,Ja=0;
function Ka(a){a.preventDefault();var b="";switch(a.type){case "mousedown":b="touchstart";Ia=a.target;break;case "mousemove":if(!Ia)return;b="touchmove";break;case "mouseup":b="touchend";Ja++}a={clientX:a.clientX,clientY:a.clientY,identifier:Ja,pageX:a.pageX,pageY:a.pageY,screenX:a.screenX,screenY:a.screenY,target:Ia};var c=document.createEvent("UIEvent");c.initEvent(b,true,false);c.type=b;c.touches=b=="touchend"?[]:[a];c.targetTouches=b=="touchend"?[]:[a];c.changedTouches=[a];Ia.dispatchEvent(c);
if(b=="touchend")Ia=null};function La(a,b){if(b)return a.replace(Ma,"&amp;").replace(Na,"&lt;").replace(Oa,"&gt;").replace(Pa,"&quot;");else{if(!Qa.test(a))return a;if(a.indexOf("&")!=-1)a=a.replace(Ma,"&amp;");if(a.indexOf("<")!=-1)a=a.replace(Na,"&lt;");if(a.indexOf(">")!=-1)a=a.replace(Oa,"&gt;");if(a.indexOf('"')!=-1)a=a.replace(Pa,"&quot;");return a}}var Ma=/&/g,Na=/</g,Oa=/>/g,Pa=/\"/g,Qa=/[&<>\"]/;
function Ra(a,b){for(var c=0,d=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),e=String(b).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),f=Math.max(d.length,e.length),i=0;c==0&&i<f;i++){var u=d[i]||"",L=e[i]||"",M=RegExp("(\\d*)(\\D*)","g"),da=RegExp("(\\d*)(\\D*)","g");do{var N=M.exec(u)||["","",""],ea=da.exec(L)||["","",""];if(N[0].length==0&&ea[0].length==0)break;c=Sa(N[1].length==0?0:parseInt(N[1],10),ea[1].length==0?0:parseInt(ea[1],10))||Sa(N[2].length==0,ea[2].length==0)||Sa(N[2],
ea[2])}while(c==0)}return c}function Sa(a,b){if(a<b)return-1;else if(a>b)return 1;return 0};var W,Ta,Ua,Va;"ScriptEngine"in j&&j.ScriptEngine()=="JScript"&&(j.ScriptEngineMajorVersion(),j.ScriptEngineMinorVersion(),j.ScriptEngineBuildVersion());function Wa(){return j.navigator?j.navigator.userAgent:null}Va=Ua=Ta=W=false;var Xa;if(Xa=Wa()){var Ya=j.navigator;W=Xa.indexOf("Opera")==0;Ta=!W&&Xa.indexOf("MSIE")!=-1;Ua=!W&&Xa.indexOf("WebKit")!=-1;Va=!W&&!Ua&&Ya.product=="Gecko"}var Za=Ta,$a=Va,ab=Ua,bb;
a:{var cb="",db;if(W&&j.opera){var eb=j.opera.version;cb=typeof eb=="function"?eb():eb}else{if($a)db=/rv\:([^\);]+)(\)|;)/;else if(Za)db=/MSIE\s+([^\);]+)(\)|;)/;else if(ab)db=/WebKit\/(\S+)/;if(db){var fb=db.exec(Wa());cb=fb?fb[1]:""}}if(Za){var gb,hb=j.document;gb=hb?hb.documentMode:undefined;if(gb>parseFloat(cb)){bb=String(gb);break a}}bb=cb}var ib={};!Za||ib["9"]||(ib["9"]=Ra(bb,"9")>=0);Za&&(ib["9"]||(ib["9"]=Ra(bb,"9")>=0));function jb(a){return'<div class="label-gameover"><div>Score: <span class="stat">'+La(String(a.f))+'</span></div><div>Level: <span class="stat">'+La(String(a.h))+"</span></div><div>Judges say... "+(a.f<10?'<span class="rating0">Awful</span>':a.f<1E3?'<span class="rating1">Weak</span>':a.f<5E3?'<span class="rating2">OK</span>':a.f<12E3?'<span class="rating3">Good</span>':a.f<2E4?'<span class="rating4">Super</span>':a.f<3E4?'<span class="rating5">Marvellous</span>':'<span class="rating6">Blockstar</span>')+
"</div>"+(a.sa?'<div class="label-highscore">It\'s a new high score!</div>':"")+'</div><div class="button-replay button-big">Replay</div><div class="button-quit button-big">Main Menu</div>'}
function kb(a){var b='<div class="scoremenu">';a=a.Ga;var c=a.length;if(c>0)for(var d=0;d<c;d++){var e=a[d];b+='<div class="'+(d==0?"label-highscore":"")+'">'+La(String(e.f))+" pts, "+La(String(e.ja))+"</div>"}else b+=" <div>No scores recorded yet!</div>";b+='<div class="button-back button-big">Back</div></div>';return b};function X(a,b){this.color=a;this.coords=b}var Y=[new X(1,[[-1,-1],[-1,0],[0,0],[0,-1]]),new X(6,[[-2,0],[-1,0],[0,0],[1,0]]),new X(2,[[0,-1],[1,-1],[0,0],[-1,0]]),new X(0,[[0,-1],[-1,-1],[0,0],[1,0]]),new X(4,[[-1,-1],[-1,0],[0,0],[1,0]]),new X(3,[[1,-1],[-1,0],[0,0],[1,0]]),new X(5,[[0,-1],[-1,0],[0,0],[1,0]])];
X.prototype.rotate=function(){if(this==Y[0])return null;else{for(var a=[],b=0;b<this.coords.length;++b){var c=this.coords[b];q(a,[-c[1],c[0]])}a=new X(this.color,a);a.x=this.x;a.y=this.y;return a}};function lb(){this.D={}}l(lb,qa);function mb(a){a.k=[];a.da=true;var b=o()*Y.length;a.Q=Y[b|0];a.ea=0;a.f=0;a.h=1;a.dispatchEvent(7);a.dispatchEvent(6);nb(a)}
function ob(a){if(a.da&&!pb(a,0,1)){for(var b=0;b<a.b.coords.length;++b){var c=a.b.coords[b];a.k[(a.b.y+c[1])*10+(a.b.x+c[0])]=true}a.dispatchEvent(2,a.b);b=[];c=0;a:for(;c<a.b.coords.length;++c){var d=a.b.y+a.b.coords[c][1];if(!(b.indexOf(d)>=0)){for(var e=0;e<10;++e)if(!a.k[d*10+e])continue a;q(b,d)}}if(b.length){b.sort();for(c=0;c<b.length;++c)for(d=b[c];d>0;){for(e=0;e<10;++e)a.k[d*10+e]=a.k[(d-1)*10+e];--d}b.reverse();c=b.length;a.f+=a.h*[40,100,300,1200][c-1];a.ea+=c;c=1+(a.ea/4|0);if(c!=a.h){a.h=
c;a.dispatchEvent(7)}a.dispatchEvent(5,b);a.dispatchEvent(6)}nb(a)}}lb.prototype.rotate=function(){var a=this.b.rotate();if(a&&qb(this,a)){this.b=a;this.dispatchEvent(3,this.b)}};function rb(a){for(;qb(a,a.b);)a.b.y+=1;a.b.y-=1;a.dispatchEvent(1,a.b);ob(a)}function pb(a,b,c){for(var d=a.b.x+b,e=a.b.y+c,f=0;f<a.b.coords.length;++f){var i=a.b.coords[f];if(d+i[0]<0||d+i[0]>=10||e+i[1]<0||e+i[1]>=20||a.k[(e+i[1])*10+(d+i[0])])return false}a.b.x=d;a.b.y=e;a.dispatchEvent(0,a.b,b,c);return true}
function qb(a,b){for(var c=0;c<b.coords.length;++c){var d=b.coords[c];if(b.x+d[0]<0||b.x+d[0]>=10||b.y+d[1]<0||b.y+d[1]>=20||a.k[(b.y+d[1])*10+(b.x+d[0])])return false}return true}function nb(a){a.b=a.Q;a.b.x=5;a.b.y=2;var b=o()*Y.length;a.Q=Y[b|0];if(qb(a,a.b))a.dispatchEvent(4,a.b,a.Q);else{a.da=false;a.dispatchEvent(8)}};function sb(a){var b=r("block");b.style.backgroundPosition=-Z*a+"px 0";return b};var $;function tb(){y.call(this);this.k=[];this.w=new y;A(this,this.w);this.e($,0,k(this.xa,this));this.e($,1,k(this.wa,this));this.e($,4,k(this.N,this));this.e($,5,k(this.Ba,this));this.e($,3,k(this.za,this));this.e($,2,k(this.ya,this))}l(tb,y);var Z=20;h=tb.prototype;h.xa=function(a){x(this.w,Z*a.x,Z*a.y)};
h.wa=function(){A(this,this.i);this.element.insertBefore(this.i.element,this.element.childNodes[0]);x(this.i,this.w.x,this.w.y);var a=this.i;a.A=10;v(a);this.i.element.style.opacity="0.2";this.i.c(new E(0,500,0.5,"linear",p,void 0));this.i.c(new U([G("opacity","0",0.5),new wa]));this.i=null};h.za=function(a){this.N(a);a=this.i;a.rotation=-90;v(a);this.i.c(new oa(90,0.1,"linear",p,void 0))};
h.ya=function(a){for(var b=0;b<a.coords.length;++b){var c=a.coords[b],d=new t(sb(a.color)),e=a.x+c[0];c=a.y+c[1];this.k[c*10+e]=d;x(d,e*Z,c*Z);A(this,d)}};h.N=function(a){this.i&&this.i.j();this.i=new ub(a);x(this.w,a.x*Z,a.y*Z);A(this.w,this.i)};
h.Ba=function(a){var b=[],c=new y;a.push(0);for(var d=[],e=0,f=a.length-1;e<f;++e){var i=a[e],u=new t(r("explosion"));x(u,0,i*Z);A(c,u);for(var L=0;L<10;++L)(u=this.k[i*10+L])&&q(b,u);i=i-1;if(i>a[e+1]){L=Math.sqrt(e+1)/4;do{for(var M=0;M<10;++M){this.k[10*(i+e+1)+M]=this.k[10*i+M];(u=this.k[10*i+M])&&q(d,new D(u.x,(i+e+1)*Z,L,"ease-in",fa,u))}--i}while(i>a[e+1])}}c.element.style.opacity="0";A(this,c);this.c(new U([G("opacity","0.8",0.5,c),new Q(function(){for(var da=0,N=b.length;da<N;++da)b[da].j();
c.j()}),new S(d)]))};function vb(a,b){b=b||Date.now();var c=b-a;if(c<6E4)return"just now";if(c<12E4)return"one minute ago";if(c<36E5)return Math.round(c/6E4)+" minutes ago";if(c<54E5)return"one hour ago";if(c<864E5)return Math.round(c/36E5)+" hours ago";if(c<1728E5)return"yesterday";if(c<2592E6)return Math.round(c/864E5)+" days ago";if(c<3888E6)return"one month ago";if(c<31104E6)return Math.round(c/2592E6)+" months ago";if(c<62208E6)return"one year ago";return Math.round(c/31104E6)+" years ago"};function wb(a){P.call(this,"transition");this.ca=a}l(wb,P);wb.prototype.load=function(){var a=this.ca,b=0;if(b<0){b+=I.length;if(b<0)b=0}else if(b>I.length)b=I.length;if(m&&I[b]==m){m.r();m=a}I.splice(b,0,a);a.load();m==a&&a.q()};wb.prototype.complete=function(){ta(this.ca)};function xb(a){P.call(this,"mainmenu");this.ia=a}l(xb,P);
xb.prototype.load=function(){var a=s('<div class="credits">by b_garcia <img src="static/twitter.png"></div><div class="ui-attract"></div>');this.d.element.appendChild(a);var b=new y;z(this,b,a.querySelector(".ui-attract"));b.c(new T(new U([new Q(function(){var c;c=o()*Y.length;c=Y[c|0];if(c!=Y[0]){var d=0,e;for(e=o()*4+0|0;d<e;++d)c=c.rotate()}c=new ub(c);d=o()*320+0;x(c,d|0,450);d=o()*4+1;la(c,2/d);c.c(new U([new E(0,-480,d,"linear",p,void 0),new wa]));A(b,c)}),new R(0.1)])));yb(this,false)};
function yb(a,b){var c=new y(s('<div class="mainmenu"><div class="button-play button-big">Play</div><div class="button-scores button-big">Scores</div></div>'));z(a,c);var d=c.element.offsetHeight;if(b||a.ia){w(c,-d);c.c(pa(0,0,0.5))}var e=new V(c.element.querySelector(".button-play"));e.n=function(){var f=m,i=new zb;w(i.d,416);var u=new wb(i);q(u.u,f);u.c(new U([new S([H(0,-416,1,f.d),G("opacity","0.2",0.5,f.d),H(0,0,1,i.d)]),new Q(function(){u.complete()})]));O(u)};e.v(a);e=new V(c.element.querySelector(".button-scores"));
e.n=function(){c.c(new U([pa(0,-d,0.5),new Q(function(){var f=c.g;c.j();Ab(f)})]))};e.v(a)}function Ab(a){var b;if("scores"in n){var c=Date.now();b=n.scores.map(function(f){return{f:f.score,ja:vb(f.date,c)}})}else b=[];var d=new y(s(kb({Ga:b})));z(a,d);var e=d.element.offsetHeight;b=new V(d.element.querySelector(".button-back"));b.n=function(){d.c(new U([pa(0,-e,0.5),new Q(function(){var f=d.g;d.j();yb(f,true)})]))};b.v(a);w(d,-e);d.c(pa(0,0,0.5))}
function Bb(){var a=m,b=new xb(true);w(b.d,-416);var c=new wb(b);c.c(new U([new S([H(0,416,1,a.d),G("opacity","0.2",0.5,a.d),H(0,0,1,b.d)]),new Q(function(){c.complete()})]));return c};function Cb(){P.call(this,"pause")}l(Cb,P);
Cb.prototype.load=function(){var a=s('<div class="label-pause">PAUSED</div><div class="button-resume button-big">Continue</div><div class="button-quit button-big">Main Menu</div>');this.d.element.appendChild(a);x(this.d,-320,100);this.d.element.style.setProperty("opacity","0","");this.c(H(0,100,0.2));this.c(G("opacity","1",0.2));var b=this,c=new V(a.querySelector(".button-resume"));c.n=function(){b.c(new U([G("opacity","0",0.2),new Q(K)]))};z(this,c,null);a=new V(a.querySelector(".button-quit"));
a.n=function(){Ea.game_end();K();O(Bb())};z(this,a,null)};function Db(){y.call(this,r("marquee"));this.label=new t(r("marquee-text"));A(this,this.label);this.element.style.setProperty("opacity","0","")}l(Db,y);function Eb(a,b){a.O();ka(a.label,200);a.label.element.innerHTML=b;setTimeout(function(){var c=a.label.element.offsetWidth;a.c(new U([G("opacity","1",0.5),H(-c,0,(c+200)/100,a.label),G("opacity","0",0.5)]))},0)};function Fb(){P.call(this,"gameover")}l(Fb,P);
Fb.prototype.load=function(){Ea.game_end();n.lastGame=Date.now();var a=n.scores;a||(n.scores=a=[]);for(var b=0;b<a.length;++b)if(a[b].score<$.f)break;a.splice(b,0,{date:Date.now(),score:$.f});if(a.length>10)a.length=10;try{localStorage["hydra:tetris"]=JSON.stringify(n)||null}catch(c){}a=s(jb({f:$.f,h:$.h,sa:b==0}));this.d.element.appendChild(a);x(this.d,320,100);this.d.element.style.setProperty("opacity","0","");this.c(H(0,100,0.2));this.c(G("opacity","1",0.2));b=new V(a.querySelector(".button-replay"));
b.n=function(){ta(new zb)};z(this,b,null);a=new V(a.querySelector(".button-quit"));a.n=function(){K();O(Bb())};z(this,a,null)};function ub(a){t.call(this);for(var b=0;b<a.coords.length;++b){var c=a.coords[b],d=sb(a.color);d.style.left=c[0]*Z+"px";d.style.top=c[1]*Z+"px";this.element.appendChild(d)}}l(ub,t);function zb(){P.call(this,"playing")}l(zb,P);h=zb.prototype;
h.load=function(){var a=this;Fa(function(){var b=s('<div class="ui-board"></div><div class="ui-preview"></div><div class="ui-score"></div><div class="ui-level"></div><div class="button-pause"></div>');a.f=new t(b.querySelector(".ui-score"));z(a,a.f,null);a.Ia=b.querySelector(".ui-preview");a.h=new t(b.querySelector(".ui-level"));z(a,a.h,null);a.d.element.appendChild(b);var c=new V(b.querySelector(".button-pause"));c.n=function(){O(new Cb)};z(a,c,null);$=new lb;b=b.querySelector(".ui-board");a.M=new Db;
w(a.M,40);"lastGame"in n||Eb(a.M,Ga?"&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Welcome to Block Dream!&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;DRAG your finger to move.&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;TAP to rotate.&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;FLICK down to drop!":"&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Welcome to Block Dream!&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Use the arrow keys to move.&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;UP key to rotate.&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;DOWN key to drop!");
z(a,a.M,b);c=new tb;z(a,c,b);a.e($,8,k(a.ta,a));a.e($,4,k(a.N,a));a.e($,6,k(a.Ca,a));a.e($,7,k(a.va,a));a.e(window,"keydown",k(a.ua,a));a.I=0;a.e(window,"touchstart",k(a.Fa,a));a.e(window,"touchmove",k(a.Ea,a));a.e(window,"touchend",k(a.Da,a));a.fa=new R(1);a.c(new T(new U([a.fa,new Q(function(){ob($)})])));mb($)})};h.ta=function(){O(new Fb)};h.N=function(a,b){this.R&&this.R.j();this.R=new ub(b);z(this,this.R,this.Ia)};
h.Ca=function(){this.f.element.textContent=String($.f);if($.f>0){la(this.f,2);this.f.c(new F(1,1,1,"ease-in",fa,void 0))}};h.va=function(){this.fa.Z=1E3/$.h;this.h.element.textContent="LVL "+$.h;if($.h>1){Eb(this.M,"Level "+La(String($.h)));la(this.h,2);this.h.c(new F(1,1,1,"ease-in",fa,void 0))}};h.ua=function(a){if(m==this){switch(a.keyCode){case 27:O(new Cb);break;case 37:pb($,-1,0);break;case 39:pb($,1,0);break;case 38:$.rotate();break;case 40:rb($);break;default:return}a.preventDefault()}};
h.Fa=function(a){if(m==this){var b=a.touches[0];this.aa=b.clientX;this.I=1;this.W=b.clientY;this.P=a.timeStamp;this.X=this.ha=null}};h.Ea=function(a){if(m==this){var b=a.touches[0];this.ha=this.W;this.X=this.P;this.W=b.clientY;this.P=a.timeStamp;a=b.clientX-this.aa;if(a>Z)pb($,1,0);else if(a<-Z)pb($,-1,0);else return;this.aa=b.clientX;this.I=2}};h.Da=function(){if(m==this){if(this.X&&(this.W-this.ha)/(this.P-this.X)>0.25)rb($);else this.I==1&&$.rotate();this.P=this.I=0}};function Gb(){P.call(this,"orientation")}l(Gb,P);Gb.prototype.load=function(){this.d.element.appendChild(s("Rotate your device to play!"));this.e(window,"orientationchange",function(){document.body.offsetWidth>320&&document.body.offsetHeight<416||K()})};if(!Ga){document.addEventListener("mousemove",Ka,true);document.addEventListener("mouseup",Ka,true);document.addEventListener("mousedown",Ka,true)}var Hb;try{Hb=JSON.parse(localStorage["hydra:tetris"]||null)}catch(Ib){Hb=null}n=Hb||{};
(function(a,b){window.vipgames.api.register({game_id:a,load:function(c){Ea=c;c.game_load({getScores:b.qa,stop:function(){ta(b.ba())},unload:va},function(){var d=document.createElement("div");d.id="hydra-stage";c.getScene().appendChild(d);J=d;d=b.ba();O(d);ba=Date.now();ca=setInterval(ua,1E3/30);b.Aa()})}})})("bruno.blockdream",{ba:function(){return new xb(false)},qa:function(){return $!=null?$.f:0},Aa:function(){function a(){(document.body.offsetWidth>320&&document.body.offsetHeight<416)&!(m instanceof
Gb)&&O(new Gb)}var b=new P("intro"),c=new t(r("darkness"));c.c(new U([new na("opacity","0",1,"ease-in",void 0),new Q(K)]));z(b,c);O(b);window.addEventListener("orientationchange",a,false);a();window.addEventListener("resize",function(){window.setTimeout(window.scrollTo,0,1,0)},false);document.addEventListener("touchstart",function(d){d.preventDefault();window.scrollTo(0,1)},true);window.scrollTo(0,1)}});})()
